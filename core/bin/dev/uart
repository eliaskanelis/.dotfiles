#!/usr/bin/env bash

# connect

# Usage:
# $ uart -d <device> -s <speed>
# Example: uart -d /dev/ttyS0 -s 9600

# Get arguments
while getopts d:s: option
do
    case "${option}"
    in
	d) device=${OPTARG};;
	s) speed=${OPTARG};;
    esac
done

# Check that device argument exists
if [ ! -c "${device}" ]; then
    echo "Error: '${device}' is not a device!"
    exit 1
fi

# Speed is optional
if [ "${speed}" = "" ]; then
    speed="9600"
    echo "Warning: Using default speed '${speed}'!"
fi

# Check that speed argument is valid
[ -n "${speed}" ] && [ "${speed}" -eq "${speed}" ] 2>/dev/null
if [ $? -ne 0 ]; then
    echo "Error: 'Speed MUST be a number"
    exit 1
fi

# Enable rlwrap
#RLWRAP="rlwrap --no-warnings -a -A -R"
RLWRAP=

${RLWRAP} miniterm "${device}" "${speed}" -e --raw --filter=direct --eol=LF --exit-char=3 -q 2>/dev/null
